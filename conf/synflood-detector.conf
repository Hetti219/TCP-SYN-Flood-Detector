# ============================================================================
# TCP SYN Flood Detector Configuration File
# ============================================================================
#
# This file controls how the detector identifies and blocks SYN flood attacks.
#
# Quick Start:
#   - Most users should start with these defaults (balanced preset)
#   - Monitor for false positives in the first 24 hours
#   - Adjust syn_threshold if needed (lower = more sensitive)
#
# For preset configurations, see: /etc/synflood-detector/presets/
# Apply presets with: sudo synflood-ctl preset apply <name>
#
# After editing, reload with: sudo synflood-ctl reload
#
# ============================================================================

# ============================================================================
# DETECTION SETTINGS
# ============================================================================
# Controls how the detector identifies potential SYN flood attacks
#
detection = {
    # Number of SYN packets from a single IP that triggers blocking
    #
    # What it does:
    #   If an IP sends this many SYN packets within the time window,
    #   it's considered a potential attack and gets blocked.
    #
    # Recommended values:
    #   Conservative: 200  (fewer false positives, may miss attacks)
    #   Balanced:     100  (good starting point for most servers)
    #   Aggressive:   50   (catches more attacks, more false positives)
    #   High-traffic: 500  (for busy servers with many connections)
    #
    # When to adjust:
    #   - Lower if you're seeing attacks get through
    #   - Higher if legitimate users are getting blocked
    #   - Check logs with: sudo synflood-ctl logs events
    #
    # Default: 100 (balanced)
    syn_threshold = 100;

    # Time window in milliseconds to count SYN packets
    #
    # What it does:
    #   The detector counts SYN packets from each IP within this window.
    #   If syn_threshold is exceeded in this time, blocking is triggered.
    #
    # Example:
    #   With syn_threshold=100 and window_ms=1000:
    #   An IP sending 100+ SYN packets in 1 second gets blocked.
    #
    # Recommended values:
    #   1000ms (1 second) works well for most cases
    #   500ms for faster detection (more aggressive)
    #   2000ms for slower detection (less sensitive)
    #
    # When to adjust:
    #   Rarely needs changes. 1000ms is the sweet spot.
    #
    # Default: 1000 (1 second)
    window_ms = 1000;

    # Interval for /proc/net/tcp validation check (seconds)
    #
    # What it does:
    #   The detector periodically validates blocked IPs by checking
    #   /proc/net/tcp to see if they have established connections.
    #   This helps reduce false positives.
    #
    # How it works:
    #   If a blocked IP has legitimate established TCP connections,
    #   it might have been a false positive. The detector logs this
    #   for analysis.
    #
    # Recommended values:
    #   Conservative: 10 seconds (more frequent validation)
    #   Balanced:     5 seconds (good balance)
    #   Aggressive:   3 seconds (frequent checks)
    #
    # Performance impact:
    #   Lower values = more frequent /proc reads (minimal CPU impact)
    #
    # Default: 5 seconds
    proc_check_interval_s = 5;
};

# ============================================================================
# ENFORCEMENT SETTINGS
# ============================================================================
# Controls how and for how long IPs are blocked
#
enforcement = {
    # How long to block an offending IP (seconds)
    #
    # What it does:
    #   When an IP is detected as attacking, it's added to the ipset
    #   blacklist for this duration. After timeout, it's automatically
    #   unblocked and can try again.
    #
    # Recommended values:
    #   Conservative: 120 seconds (2 minutes)  - quick recovery from false positives
    #   Balanced:     300 seconds (5 minutes)  - good deterrent
    #   Aggressive:   600 seconds (10 minutes) - strong protection
    #   High-traffic: 180 seconds (3 minutes)  - faster rotation
    #
    # Trade-offs:
    #   Shorter duration:
    #     + Faster recovery from false positives
    #     - Attackers can retry sooner
    #
    #   Longer duration:
    #     + Better protection against persistent attacks
    #     - False positives take longer to clear
    #
    # When to adjust:
    #   - Increase during active attacks
    #   - Decrease if false positives are common
    #   - Check blocked IPs with: sudo synflood-ctl blocked list
    #
    # Default: 300 (5 minutes)
    block_duration_s = 300;

    # Name of the ipset to use for blacklisting
    #
    # What it does:
    #   Blocked IPs are added to this ipset, which is referenced by
    #   an iptables rule that drops all packets from blacklisted IPs.
    #
    # Advanced:
    #   Only change this if you have custom firewall rules or need
    #   to avoid naming conflicts with existing ipsets.
    #
    # Default: "synflood_blacklist"
    ipset_name = "synflood_blacklist";
};

# ============================================================================
# RESOURCE LIMITS
# ============================================================================
# Controls memory usage and capacity
#
limits = {
    # Maximum number of IP addresses to track simultaneously
    #
    # What it does:
    #   The detector maintains a hash table of IPs it's monitoring.
    #   This sets the maximum size of that table.
    #
    # Memory usage:
    #   Each tracked IP uses approximately 100 bytes of memory
    #   10,000 IPs ≈ 1 MB RAM
    #   50,000 IPs ≈ 5 MB RAM
    #
    # Recommended values:
    #   Small servers:   10,000  (handles most scenarios)
    #   Medium servers:  25,000  (busy web servers)
    #   Large servers:   50,000  (high-traffic applications)
    #
    # What happens when limit is reached:
    #   Oldest tracked IPs are evicted to make room for new ones.
    #   Blocked IPs remain blocked until timeout expires.
    #
    # When to adjust:
    #   - Increase if seeing "tracker table full" warnings in logs
    #   - Check tracker usage with: sudo synflood-ctl status
    #
    # Default: 10000
    max_tracked_ips = 10000;

    # Hash table bucket count (must be power of 2)
    #
    # What it does:
    #   The hash table uses this many buckets to organize tracked IPs.
    #   More buckets = better performance with many tracked IPs.
    #
    # Performance impact:
    #   Lookup time: O(tracked_ips / buckets) average case
    #   With 10,000 IPs and 4,096 buckets: ~2.4 IPs per bucket
    #
    # Recommended values:
    #   For max_tracked_ips up to 10,000:  4096 buckets
    #   For max_tracked_ips up to 25,000:  8192 buckets
    #   For max_tracked_ips up to 50,000:  16384 buckets
    #
    # Rules:
    #   - Must be a power of 2 (1024, 2048, 4096, 8192, 16384, etc.)
    #   - Larger values use more memory but improve performance
    #   - Generally set to max_tracked_ips / 2 or max_tracked_ips / 4
    #
    # Default: 4096
    hash_buckets = 4096;
};

# ============================================================================
# PACKET CAPTURE SETTINGS
# ============================================================================
# Controls how the detector receives packets for analysis
#
capture = {
    # NFQUEUE number to use
    #
    # What it does:
    #   The detector uses Linux NFQUEUE to receive copies of SYN packets.
    #   This is the queue number that iptables forwards packets to.
    #
    # When to change:
    #   Only if you have other applications using NFQUEUE and need to
    #   avoid conflicts. Most users should leave this at 0.
    #
    # Technical details:
    #   The systemd service automatically creates this iptables rule:
    #   iptables -I INPUT -p tcp --syn -j NFQUEUE --queue-num 0
    #
    # Default: 0
    nfqueue_num = 0;

    # Use raw socket instead of NFQUEUE (fallback mode)
    #
    # What it does:
    #   If true, uses raw sockets instead of NFQUEUE to capture packets.
    #   This is a fallback mode if NFQUEUE is unavailable.
    #
    # When to enable:
    #   - NFQUEUE is not supported on your kernel
    #   - You see "Failed to open NFQUEUE" errors
    #   - Running in a restricted environment (containers, some VPS)
    #
    # Trade-offs:
    #   NFQUEUE (false):
    #     + More efficient
    #     + Better packet handling
    #     + Recommended for most users
    #
    #   Raw socket (true):
    #     + Works without netfilter_queue
    #     - Slightly higher CPU usage
    #     - May miss some packets under extreme load
    #
    # Default: false (use NFQUEUE)
    use_raw_socket = false;
};

# ============================================================================
# WHITELIST SETTINGS
# ============================================================================
# Configure which IPs should never be blocked
#
whitelist = {
    # Path to whitelist file containing trusted IPs/CIDRs
    #
    # What it does:
    #   IPs and CIDR ranges listed in this file will never be blocked,
    #   even if they exceed the SYN threshold.
    #
    # File format:
    #   One IP address or CIDR range per line
    #   Lines starting with # are comments
    #
    #   Example:
    #     # Localhost
    #     127.0.0.1
    #     127.0.0.0/8
    #
    #     # Office network
    #     192.168.1.0/24
    #
    #     # Monitoring server
    #     10.0.5.100
    #
    # What to whitelist:
    #   - Your own IP addresses
    #   - Monitoring/health check services
    #   - Load balancers
    #   - Known high-traffic legitimate clients
    #   - CDN edge servers (if applicable)
    #
    # Management:
    #   Add:    sudo synflood-ctl whitelist add <ip>
    #   Remove: sudo synflood-ctl whitelist remove <ip>
    #   List:   sudo synflood-ctl whitelist list
    #   Edit:   sudo synflood-ctl whitelist edit
    #
    # Important:
    #   After editing the whitelist file, reload with:
    #   sudo synflood-ctl reload
    #
    # Default: /etc/synflood-detector/whitelist.conf
    file = "/etc/synflood-detector/whitelist.conf";
};

# ============================================================================
# LOGGING SETTINGS
# ============================================================================
# Controls logging output and metrics
#
logging = {
    # Log level: debug, info, warn, error
    #
    # What each level shows:
    #   debug: Everything (verbose, for troubleshooting)
    #   info:  Normal operations, detections, blocks (recommended)
    #   warn:  Only warnings and errors (quiet)
    #   error: Only errors (very quiet)
    #
    # When to change:
    #   - Use "debug" when troubleshooting issues
    #   - Use "warn" or "error" on very busy servers to reduce logs
    #   - Use "info" for normal operation (shows what's happening)
    #
    # View logs:
    #   All logs:  sudo synflood-ctl logs
    #   Follow:    sudo synflood-ctl logs -f
    #   Events:    sudo synflood-ctl logs events
    #
    # Default: "info"
    level = "info";

    # Use systemd journal for logging
    #
    # What it does:
    #   When true, logs are sent to systemd's journal (recommended).
    #   When false, logs go to stderr only.
    #
    # Benefits of systemd journal:
    #   - Automatic log rotation
    #   - Structured logging
    #   - Easy filtering and searching
    #   - Integration with system logs
    #
    # When to disable:
    #   Rarely needed. Only disable if you're not using systemd
    #   or want to redirect logs to a custom destination.
    #
    # Default: true
    syslog = true;

    # Unix socket path for metrics API
    #
    # What it does:
    #   The detector exposes Prometheus-compatible metrics via this
    #   Unix socket. Tools like synflood-ctl use this to display stats.
    #
    # Metrics available:
    #   - Total packets processed
    #   - SYN packets analyzed
    #   - Currently blocked IPs
    #   - Total detections
    #   - Whitelist hits
    #   - Tracker entries
    #
    # Access metrics:
    #   Human-readable: sudo synflood-ctl status
    #   Raw format:     sudo synflood-ctl metrics --raw
    #   Direct access:  echo "GET /metrics" | socat - UNIX:/var/run/synflood-detector.sock
    #
    # When to change:
    #   Only if you have permission issues with /var/run or want
    #   to place the socket elsewhere.
    #
    # Default: /var/run/synflood-detector.sock
    metrics_socket = "/var/run/synflood-detector.sock";
};

# ============================================================================
# TROUBLESHOOTING
# ============================================================================
#
# Issue: Too many false positives (legitimate users getting blocked)
# Solutions:
#   1. Increase syn_threshold (e.g., from 100 to 150 or 200)
#   2. Add legitimate IPs to whitelist
#   3. Increase window_ms (e.g., from 1000 to 2000)
#   4. Check logs: sudo synflood-ctl logs events
#
# Issue: Attacks getting through
# Solutions:
#   1. Decrease syn_threshold (e.g., from 100 to 50 or 75)
#   2. Increase block_duration_s (e.g., from 300 to 600)
#   3. Apply aggressive preset: sudo synflood-ctl preset apply aggressive
#   4. Monitor with: sudo synflood-ctl status
#
# Issue: High CPU usage
# Solutions:
#   1. Increase syn_threshold to reduce detections
#   2. Check tracker size: sudo synflood-ctl status
#   3. Increase hash_buckets if tracker is large
#   4. Consider use_raw_socket = true if NFQUEUE is causing issues
#
# Issue: "Tracker table full" warnings
# Solutions:
#   1. Increase max_tracked_ips (e.g., to 25000 or 50000)
#   2. Increase hash_buckets proportionally
#   3. Check if you're under DDoS: sudo synflood-ctl blocked list
#
# ============================================================================
# For more information, see:
#   Documentation: /usr/local/share/doc/synflood-detector/
#   Man page:      man synflood-detector
#   GitHub:        https://github.com/Hetti219/TCP-SYN-Flood-Detector
# ============================================================================
