# TCP SYN Flood Detector - HIGH-TRAFFIC Preset
# =============================================
#
# USE THIS PRESET WHEN:
#   - Your server handles very high volumes of legitimate traffic
#   - You're running a popular website, API, or service
#   - You have thousands of concurrent users
#   - You're behind a load balancer or CDN
#   - Normal traffic patterns already exceed 100 SYN/sec from some IPs
#
# CHARACTERISTICS:
#   - High threshold (500 SYN/sec) - tolerates traffic spikes
#   - Short block duration (3 minutes) - quick recovery
#   - Increased tracking capacity - handles more unique IPs
#   - Larger hash table - better performance at scale
#
# TRADE-OFFS:
#   ✓ Minimal false positives even under heavy load
#   ✓ Handles traffic spikes gracefully
#   ✓ Better performance for high-traffic scenarios
#   ✗ Only catches very aggressive attacks
#   ✗ Subtle attacks may go undetected
#   ✗ Higher memory usage
#
# RECOMMENDED FOR:
#   - E-commerce sites during sales events
#   - Popular APIs with many clients
#   - Gaming servers
#   - Streaming services
#   - Any service with >10,000 concurrent users
#
# RESOURCE REQUIREMENTS:
#   - Memory: ~35-50MB (vs ~12-20MB for balanced)
#   - CPU: Similar to balanced preset
#
# TO APPLY THIS PRESET:
#   sudo synflood-ctl preset apply high-traffic
#
# TUNING TIP:
#   Monitor your normal SYN traffic patterns first:
#   sudo synflood-ctl metrics
#   Then adjust syn_threshold to be 2-3x your peak legitimate rate

# Detection parameters
detection = {
    # High threshold - blocks IPs sending 500+ SYN packets per second
    # Suitable for high-traffic environments where spikes are normal
    syn_threshold = 500;

    # Standard 1-second detection window
    window_ms = 1000;

    # Regular /proc validation every 5 seconds
    proc_check_interval_s = 5;
};

# Enforcement parameters
enforcement = {
    # Shorter block duration (3 minutes)
    # Minimizes impact if legitimate high-traffic client is blocked
    block_duration_s = 180;

    # Standard ipset name
    ipset_name = "synflood_blacklist";
};

# Resource limits - INCREASED for high traffic
limits = {
    # Track up to 50,000 unique IPs
    # 5x the default - needed for high-traffic scenarios
    max_tracked_ips = 50000;

    # Larger hash table with 16384 buckets
    # Better performance when tracking many IPs
    # Rule of thumb: hash_buckets = max_tracked_ips / 3
    hash_buckets = 16384;
};

# Packet capture configuration
capture = {
    nfqueue_num = 0;
    use_raw_socket = false;
};

# Whitelist configuration
whitelist = {
    file = "/etc/synflood-detector/whitelist.conf";
};

# Logging configuration
logging = {
    # Info level - see blocks and important events
    # Use "warn" if logs are too verbose in high-traffic scenarios
    level = "info";
    syslog = true;
    metrics_socket = "/var/run/synflood-detector.sock";
};
